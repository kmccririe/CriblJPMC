exports.name="Unhealthy Destination";exports.type="metric";exports.category="destinations";let name;let __workerGroup;let timeWindow;exports.init=e=>{const t=e.conf||{};({name,__workerGroup,timeWindow}=t);timeWindow=timeWindow||"60s"};exports.build=()=>{let e=`(_metric === 'health.outputs' && output === '${name}')`;let t=`'Destination ${name} is unhealthy'`;const o=[{name:"output",value:`'${name}'`},{name:"_metric",value:"'health.outputs'"}];if(__workerGroup){e=`${e} && __worker_group === '${__workerGroup}'`;t=`'Destination ${name} in group ${__workerGroup} is unhealthy'`}o.push({name:"_raw",value:t});return{filter:e,pipeline:{conf:{functions:[{id:"aggregation",conf:{timeWindow,aggregations:["perc(95, _value).as(health)"],lagTolerance:"20s",idleTimeLimit:"20s"}},{id:"drop",filter:"Math.round(health) < 2",conf:{}},{id:"eval",conf:{add:o}}]}}}};